<html>
    <head>
        <title>PowuhGred</title>
    </head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>


    <canvas id="mapCanvas" width="2000" height="2000" style=""></canvas>


    <script>
        var socket = io();
        var citiesDef = {};
        var offsetx = -5;
        var offsety = -96;
        var scalex = 1.1;
        var scaley = 1.1;

        // load up the city map right after connecting
        socket.on('definecities', function(data){

            // get the dictionary of city.js objects (taken from cities.js)
            $.each(data, function(key, value){
                citiesDef[key] = value;
            });

            var c = document.getElementById("mapCanvas");
            var ctx = c.getContext("2d");

            // draw the background image
            var imageObj = new Image();
            imageObj.src = "./data/germany.jpg";

            imageObj.onload = function() {
                ctx.drawImage(imageObj, 0, 0);


                // draw our internal data structure as an overlay
                $.each(citiesDef, function(key, city){
                    ctx.strokeStyle = "#444444";
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    var x = city.x * scalex + offsetx;
                    var y = city.y * scaley + offsety;
                    ctx.arc(x, y, 12, 0, 360, false);
                    ctx.stroke();

                    ctx.font = "10px Arial";
                    ctx.fillText(city.name.toUpperCase(),x,y);
                });
            };
        });
    </script>


</html>